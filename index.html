<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Saffron & Spice | Authentic Indian Flavors</title>
    <!-- Tailwind via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;800;900&family=Inter:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@500;600;700&family=Cormorant+Garamond:wght@600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ---------- PREMIUM DESIGN SYSTEM ---------- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            background: radial-gradient(circle at 0% 0%, #fff9f0, #fef6e7, #fff4e6);
            scroll-behavior: smooth;
        }
        
        .brand-font { 
            font-family: 'Playfair Display', serif; 
            font-weight: 900; 
            letter-spacing: -0.02em;
        }
        
        .product-name-font { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            font-weight: 600; 
        }
        
        /* ----- HERO SECTION WITH LUXURY OVERLAY ----- */
        .hero-section {
            background: linear-gradient(145deg, rgba(0,0,0,0.85) 0%, rgba(154,52,18,0.75) 100%), 
                        url('https://images.unsplash.com/photo-1606491956689-2ea866880c84?auto=format&fit=crop&w=2000&q=90');
            background-size: cover;
            background-position: center 25%;
            background-attachment: fixed;
            position: relative;
            isolation: isolate;
        }
        
        @media (max-width: 768px) {
            .hero-section { background-attachment: scroll; }
        }
        
        .hero-mandala {
            position: absolute;
            right: 2%;
            bottom: 5%;
            width: min(45vw, 350px);
            height: min(45vw, 350px);
            opacity: 0.18;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="none" stroke="%23fde68a" stroke-width="0.6"/><circle cx="50" cy="50" r="35" fill="none" stroke="%23fcd34d" stroke-width="0.4"/><circle cx="50" cy="50" r="25" fill="none" stroke="%23fbbf24" stroke-width="0.3"/><path d="M50 5 L50 95 M5 50 L95 50 M20 20 L80 80 M80 20 L20 80" stroke="%23f59e0b" stroke-width="0.5"/></svg>');
            background-size: contain;
            animation: rotateSlow 80s linear infinite;
            pointer-events: none;
        }
        
        @keyframes rotateSlow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        /* ----- MODERN GLASS MORPHISM ----- */
        .glass-deep {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255,255,255,0.4);
            box-shadow: 0 20px 40px -12px rgba(0,0,0,0.2);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border: 1px solid rgba(255,255,255,0.5);
            box-shadow: 0 15px 35px -10px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.85);
            border-color: rgba(249,115,22,0.4);
            box-shadow: 0 25px 45px -12px rgba(234,88,12,0.25);
        }
        
        .menu-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255,237,213,0.7);
            border-radius: 28px;
            transition: all 0.4s cubic-bezier(0.2, 0.9, 0.4, 1);
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .menu-card:hover {
            background: rgba(255,255,255,0.98);
            border-color: #f97316;
            box-shadow: 0 35px 55px -20px rgba(194,65,12,0.3);
            transform: translateY(-8px) scale(1.02);
        }
        
        .menu-image {
            background-size: cover;
            background-position: center;
            transition: transform 0.7s cubic-bezier(0.2, 0.8, 0.4, 1);
            height: 220px;
        }
        
        .menu-card:hover .menu-image { transform: scale(1.12); }
        
        /* ----- CATEGORY FILTERS ----- */
        .category-filter {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(8px);
            border: 1.5px solid rgba(255,255,255,0.6);
            color: #44403c;
            font-weight: 600;
            padding: 0.6rem 1.4rem;
            border-radius: 60px;
            transition: all 0.3s;
            font-size: 0.95rem;
            letter-spacing: 0.3px;
        }
        
        .category-filter.active {
            background: linear-gradient(145deg, #c2410c, #b45309);
            color: white;
            border-color: #fef3c7;
            box-shadow: 0 12px 22px -8px rgba(180,83,9,0.5);
        }
        
        /* ----- SEARCH ----- */
        .search-box {
            width: 100%;
            padding: 1.1rem 1.1rem 1.1rem 3.2rem;
            border-radius: 80px;
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(251, 191, 36, 0.3);
            font-size: 1rem;
            transition: all 0.25s;
        }
        
        .search-box:focus {
            background: white;
            border-color: #f97316;
            box-shadow: 0 0 0 5px rgba(253,186,116,0.3);
            outline: none;
        }
        
        /* ----- CART & CHECKOUT STYLING ----- */
        .floating-cart-btn {
            position: fixed;
            bottom: 25px;
            right: 25px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(145deg, #f97316, #dc2626);
            box-shadow: 0 15px 35px #dc262660;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 90;
            transition: all 0.3s;
        }
        
        .floating-cart-btn:hover {
            transform: scale(1.12) rotate(8deg);
            box-shadow: 0 20px 45px #dc262680;
        }
        
        .cart-drawer { 
            transform: translateX(100%); 
            transition: transform 0.4s cubic-bezier(0.2, 0.95, 0.3, 1.05); 
        }
        .cart-drawer.open { transform: translateX(0); }
        
        /* ----- PREMIUM CHECKOUT STYLES ----- */
        .checkout-card {
            background: white;
            border-radius: 32px;
            box-shadow: 0 30px 60px -20px rgba(0,0,0,0.25);
            border: 1px solid rgba(255,215,0,0.2);
        }
        
        .payment-option {
            transition: all 0.3s;
            border: 2px solid transparent;
            background: linear-gradient(white, white) padding-box,
                        linear-gradient(145deg, #fef3c7, #fed7aa) border-box;
            border-radius: 20px;
        }
        
        .payment-option:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 25px -8px rgba(251,146,60,0.3);
        }
        
        .payment-option.selected {
            background: linear-gradient(white, white) padding-box,
                        linear-gradient(145deg, #f97316, #dc2626) border-box;
            border-width: 2px;
        }
        
        /* ----- SUCCESS PAGE CELEBRATION ----- */
        .success-checkmark {
            width: 100px;
            height: 100px;
            margin: 0 auto;
            position: relative;
        }
        
        .success-checkmark .check-icon {
            width: 100px;
            height: 100px;
            position: relative;
            border-radius: 50%;
            box-sizing: content-box;
            border: 5px solid #10b981;
            background: linear-gradient(145deg, #ecfdf5, #d1fae5);
            box-shadow: 0 15px 35px -10px #10b98180;
        }
        
        .success-checkmark .check-icon .icon-line {
            height: 6px;
            background-color: #10b981;
            display: block;
            border-radius: 3px;
            position: absolute;
            z-index: 10;
        }
        
        .success-checkmark .check-icon .icon-line.line-tip {
            width: 30px;
            left: 18px;
            top: 56px;
            transform: rotate(45deg);
            animation: icon-tip 0.6s;
        }
        
        .success-checkmark .check-icon .icon-line.line-long {
            width: 55px;
            right: 12px;
            top: 48px;
            transform: rotate(-45deg);
            animation: icon-long 0.6s;
        }
        
        @keyframes icon-tip {
            0% { width: 0; left: 1px; top: 25px; }
            54% { width: 0; left: 1px; top: 25px; }
            70% { width: 40px; left: 0px; top: 45px; }
            100% { width: 30px; left: 18px; top: 56px; }
        }
        
        @keyframes icon-long {
            0% { width: 0; right: 36px; top: 58px; }
            65% { width: 0; right: 36px; top: 58px; }
            84% { width: 65px; right: 8px; top: 45px; }
            100% { width: 55px; right: 12px; top: 48px; }
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: linear-gradient(145deg, #f59e0b, #f97316);
            opacity: 0.7;
            animation: confetti-fall 3s ease-in-out infinite;
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-10px) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        /* ----- LOADER ----- */
        .loader {
            border: 3px solid rgba(249,115,22,0.1);
            border-top-color: #f97316;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            animation: spin 0.9s infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* ----- TOAST ----- */
        .toast-message {
            position: fixed;
            top: 25px;
            right: 25px;
            z-index: 9999;
            background: rgba(15,23,42,0.9);
            backdrop-filter: blur(12px);
            color: white;
            padding: 14px 28px;
            border-radius: 60px;
            font-weight: 500;
            box-shadow: 0 25px 40px -12px black;
            animation: slideInRight 0.3s;
        }
        
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* ----- UTILITIES ----- */
        .bg-grid-spice {
            background-image: radial-gradient(circle at 12px 12px, rgba(245,158,11,0.08) 2px, transparent 2px);
            background-size: 30px 30px;
        }
        
        .floating-spice {
            animation: float 7s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-14px) rotate(5deg); }
            100% { transform: translateY(0px) rotate(0deg); }
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(290px, 1fr));
            gap: 2rem;
        }
        
        @media (max-width: 640px) {
            .menu-grid { grid-template-columns: 1fr; }
            .category-filter { padding: 0.5rem 1rem; font-size: 0.8rem; }
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 2.5rem;
        }
        
        /* ----- ANIMATIONS ----- */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-up {
            animation: fadeInUp 0.6s ease-out;
        }
        
        /* ----- CUSTOM SCROLLBAR ----- */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #fff7ed; border-radius: 5px; }
        ::-webkit-scrollbar-thumb { 
            background: linear-gradient(145deg, #f97316, #dc2626);
            border-radius: 5px; 
        }
        ::-webkit-scrollbar-thumb:hover { background: linear-gradient(145deg, #ea580c, #b91c1c); }
    </style>
</head>
<body class="antialiased text-stone-800 relative min-h-screen">

    <!-- Subtle spice grid background -->
    <div class="fixed inset-0 bg-grid-spice opacity-15 pointer-events-none z-0"></div>
    
    <!-- Main content wrapper -->
    <div class="relative z-10 flex flex-col min-h-screen w-full">

        <!-- ===== NAVIGATION ‚Äì LUXURY GLASS ===== -->
        <nav class="sticky top-0 z-50 glass-card border-b border-amber-200/70 shadow-xl py-2 sm:py-3 w-full">
            <div class="container mx-auto px-4 lg:px-8 flex items-center justify-between flex-wrap">
                <!-- Logo with animation -->
                <div class="flex items-center gap-3">
                    <div class="bg-gradient-to-br from-red-700 to-orange-600 p-2.5 rounded-2xl shadow-xl floating-spice">
                        <i class="fas fa-pepper-hot text-white text-xl sm:text-2xl"></i>
                    </div>
                    <div class="flex flex-col">
                        <h1 class="text-xl sm:text-2xl md:text-3xl font-black brand-font bg-gradient-to-r from-orange-700 to-red-700 bg-clip-text text-transparent leading-tight">
                            SAFFRON & SPICE
                        </h1>
                        <span class="text-[10px] sm:text-xs text-stone-600 -mt-1 font-medium">Since 1972 ‚Ä¢ Authentic Indian</span>
                    </div>
                </div>
                
                <!-- Right buttons -->
                <div class="flex items-center gap-2 sm:gap-4">
                    <button onclick="openTracking()" class="hidden sm:flex items-center gap-2 bg-stone-800/90 backdrop-blur-sm text-white px-4 py-2.5 sm:px-6 sm:py-3 rounded-full text-sm font-bold hover:bg-stone-900 transition shadow-lg border border-white/20">
                        <i class="fas fa-truck text-xs"></i> Track Order
                    </button>
                    <button onclick="toggleCart()" class="relative bg-gradient-to-r from-orange-500 to-red-600 text-white p-3 sm:p-3.5 rounded-2xl shadow-xl hover:shadow-2xl transition active:scale-95 group">
                        <i class="fas fa-shopping-basket text-lg sm:text-xl"></i>
                        <span id="cart-badge" class="absolute -top-2 -right-2 bg-red-800 text-white text-xs font-bold w-6 h-6 rounded-full flex items-center justify-center border-2 border-white shadow-lg hidden">0</span>
                        <div class="absolute top-full right-0 mt-3 bg-white text-stone-800 text-xs py-2 px-4 rounded-full shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all whitespace-nowrap font-medium">
                            View Basket
                        </div>
                    </button>
                </div>
            </div>
        </nav>

        <!-- ===== HERO ‚Äì CINEMATIC & IMMERSIVE ===== -->
        <header class="hero-section w-full min-h-[70vh] sm:min-h-[75vh] lg:min-h-[85vh] flex items-center justify-center px-4 py-12 relative overflow-hidden">
            <div class="hero-mandala"></div>
            
            <!-- Floating spices - decorative -->
            <div class="absolute left-[5%] top-[20%] text-white/25 text-5xl sm:text-7xl floating-spice opacity-40 hidden sm:block" style="animation-delay:0s;">üå∂Ô∏è</div>
            <div class="absolute right-[8%] bottom-[25%] text-white/25 text-5xl sm:text-7xl floating-spice opacity-40 hidden md:block" style="animation-delay:2s;">ü´ö</div>
            <div class="absolute left-[15%] bottom-[15%] text-white/25 text-5xl floating-spice opacity-40 hidden lg:block" style="animation-delay:1.5s;">üçõ</div>
            <div class="absolute right-[20%] top-[15%] text-white/25 text-5xl floating-spice opacity-40 hidden lg:block" style="animation-delay:2.5s;">üßÇ</div>
            
            <div class="relative z-20 w-full max-w-6xl mx-auto text-center px-2 sm:px-6">
                <!-- Premium badge -->
                <span class="inline-block mb-6 sm:mb-8 px-5 sm:px-8 py-2.5 sm:py-3.5 rounded-full bg-gradient-to-r from-amber-500/30 to-orange-600/30 backdrop-blur-2xl border border-white/40 text-white text-xs sm:text-sm font-bold tracking-wider shadow-2xl animate-pulse">
                    ‚ö° FREE DELIVERY OVER ¬£25 ‚Ä¢ MICHELIN-STYLE RECIPES
                </span>
                
                <h2 class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-8xl font-black text-white mb-4 sm:mb-6 brand-font drop-shadow-2xl leading-[1.2]">
                    Taste the <span class="text-amber-300 relative">Authentic
                        <span class="absolute -bottom-2 left-0 w-full h-1 bg-gradient-to-r from-amber-400 to-orange-500 rounded-full"></span>
                    </span><br class="hidden xs:block"> Flavors of India
                </h2>
                
                <p class="text-stone-100 text-base sm:text-lg md:text-xl lg:text-2xl mb-8 sm:mb-10 max-w-3xl mx-auto font-light px-4 backdrop-blur-sm bg-black/10 py-3 rounded-full inline-block">
                    Centuries-old recipes ‚Ä¢ Handpicked spices ‚Ä¢ Master chefs
                </p>
                
                <div class="flex flex-col sm:flex-row items-center justify-center gap-5 sm:gap-6 w-full max-w-lg sm:max-w-2xl mx-auto">
                    <a href="#menu-area" class="w-full sm:w-auto inline-flex items-center justify-center bg-white/95 backdrop-blur-sm text-red-900 px-10 py-5 sm:px-12 sm:py-6 rounded-full font-bold hover:bg-gradient-to-r hover:from-orange-500 hover:to-red-600 hover:text-white transition-all duration-500 text-base shadow-2xl group">
                        <span>Explore Menu</span>
                        <i class="fas fa-arrow-down ml-2 group-hover:translate-y-1.5 transition-transform"></i>
                    </a>
                    <button onclick="toggleCart()" class="w-full sm:w-auto inline-flex items-center justify-center bg-orange-500/20 backdrop-blur-2xl text-white border-2 border-white/50 px-10 py-5 sm:px-12 sm:py-6 rounded-full font-bold hover:bg-orange-600/40 transition-all duration-500 text-base shadow-2xl">
                        <i class="fas fa-shopping-basket mr-2"></i> Order Now
                    </button>
                </div>
            </div>
        </header>

        <!-- ===== MENU SECTION ‚Äì MODERN GLASS GRID ===== -->
        <section id="menu-area" class="w-full py-16 sm:py-20 md:py-24 relative">
            <!-- Background layers -->
            <div class="absolute inset-0 bg-gradient-to-b from-transparent via-amber-50/40 to-orange-100/30 pointer-events-none"></div>
            <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1626777552726-4a6b54c97e46?auto=format&fit=crop&w=1500&q=80')] bg-cover bg-center opacity-5"></div>
            
            <div class="container mx-auto px-4 lg:px-8 relative">
                <!-- Section header -->
                <div class="text-center max-w-4xl mx-auto mb-12 sm:mb-16 px-2">
                    <div class="inline-block px-6 py-2.5 rounded-full bg-white/70 backdrop-blur-md border border-orange-200/80 mb-5 shadow-lg">
                        <span class="text-xs sm:text-sm font-bold text-stone-700 tracking-[0.2em] uppercase">‚ú® Signature Collection</span>
                    </div>
                    <h3 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-black brand-font text-stone-800 drop-shadow-sm mb-4">
                        Our Culinary Journey
                    </h3>
                    <p class="text-stone-600 text-base sm:text-lg md:text-xl max-w-2xl mx-auto mb-8 px-4 font-light">
                        Tradition, spice & passion on every plate
                    </p>
                    
                    <!-- Search bar - premium -->
                    <div class="w-full max-w-xs sm:max-w-md md:max-w-xl mx-auto relative">
                        <i class="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-orange-500 text-sm sm:text-base"></i>
                        <input type="text" id="search-box" placeholder="Search dishes (butter chicken, biryani, naan...)" 
                               class="search-box w-full pl-12 pr-12 py-4 sm:py-5 text-sm sm:text-base"
                               oninput="handleSearch()">
                        <button id="clear-search" onclick="clearSearch()" class="absolute right-5 top-1/2 -translate-y-1/2 text-stone-400 hover:text-red-600 transition hidden">
                            <i class="fas fa-times-circle"></i>
                        </button>
                    </div>
                </div>

                <!-- Category filters -->
                <div id="category-filters-container" class="flex flex-wrap justify-center gap-2 sm:gap-3 mb-12 px-1">
                    <!-- JS will populate -->
                    <div class="flex justify-center py-4">
                        <div class="loader w-10 h-10"></div>
                    </div>
                </div>

                <!-- Product grid -->
                <div id="product-grid" class="menu-grid min-h-[500px] w-full">
                    <!-- Loading state -->
                    <div class="col-span-full flex flex-col items-center py-20">
                        <div class="loader mb-6"></div>
                        <p class="text-stone-500 text-sm sm:text-base font-medium">Loading authentic Indian flavors...</p>
                    </div>
                </div>
                
                <!-- No results -->
                <div id="no-results" class="hidden text-center py-16 sm:py-20">
                    <div class="glass-card rounded-3xl p-10 sm:p-14 max-w-lg mx-auto">
                        <div class="bg-gradient-to-br from-amber-100 to-orange-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-utensils text-amber-600 text-3xl"></i>
                        </div>
                        <h4 class="text-xl sm:text-2xl font-bold text-stone-800 mb-3">No dishes found</h4>
                        <p class="text-stone-500 mb-6 text-sm sm:text-base">Try adjusting your search or filter</p>
                        <button onclick="clearSearch()" class="bg-gradient-to-r from-orange-500 to-red-600 text-white px-8 py-4 rounded-full font-bold shadow-xl text-sm sm:text-base hover:shadow-2xl transition">
                            Clear Search
                        </button>
                    </div>
                </div>
                
                <!-- No products in DB -->
                <div id="no-products" class="hidden text-center py-16 sm:py-20">
                    <div class="glass-card rounded-3xl p-10 sm:p-14 max-w-lg mx-auto">
                        <div class="bg-gradient-to-br from-amber-100 to-orange-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-database text-amber-600 text-3xl"></i>
                        </div>
                        <h4 class="text-xl sm:text-2xl font-bold text-stone-800 mb-3">No Menu Items Available</h4>
                        <p class="text-stone-500 text-sm sm:text-base">Our chefs are preparing new delicacies</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ===== FOOTER ‚Äì ELEGANT DARK GLASS ===== -->
        <footer class="w-full bg-stone-900/95 backdrop-blur-md border-t border-amber-700/30 mt-auto">
            <div class="container mx-auto px-4 lg:px-8 py-16 sm:py-20">
                <div class="footer-grid">
                    <div>
                        <div class="flex items-center gap-3 mb-6">
                            <div class="bg-gradient-to-br from-orange-600 to-red-600 p-3 rounded-2xl shadow-xl">
                                <i class="fas fa-pepper-hot text-white text-xl"></i>
                            </div>
                            <h3 class="text-2xl sm:text-3xl font-black brand-font text-white">Saffron & Spice</h3>
                        </div>
                        <p class="text-stone-400 text-sm sm:text-base leading-relaxed max-w-xs">
                            Authentic Indian cuisine crafted with heirloom spices and generations of love. Every bite tells a story.
                        </p>
                        <div class="flex gap-5 mt-7">
                            <a href="#" class="w-11 h-11 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 transition-all hover:scale-110"><i class="fab fa-facebook-f text-white/90"></i></a>
                            <a href="#" class="w-11 h-11 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 transition-all hover:scale-110"><i class="fab fa-instagram text-white/90"></i></a>
                            <a href="#" class="w-11 h-11 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 transition-all hover:scale-110"><i class="fab fa-x-twitter text-white/90"></i></a>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="text-white font-bold text-lg sm:text-xl mb-6">Quick Links</h4>
                        <ul class="space-y-4 text-stone-300 text-sm sm:text-base">
                            <li><a href="#menu-area" class="hover:text-amber-400 transition flex items-center gap-3"><i class="fas fa-chevron-right text-xs text-amber-500"></i> Our Menu</a></li>
                            <li><button onclick="openTracking()" class="hover:text-amber-400 transition flex items-center gap-3"><i class="fas fa-chevron-right text-xs text-amber-500"></i> Track Order</button></li>
                            <li><a href="#" class="hover:text-amber-400 transition flex items-center gap-3"><i class="fas fa-chevron-right text-xs text-amber-500"></i> Special Offers</a></li>
                            <li><a href="#" class="hover:text-amber-400 transition flex items-center gap-3"><i class="fas fa-chevron-right text-xs text-amber-500"></i> Contact Us</a></li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="text-white font-bold text-lg sm:text-xl mb-6">Contact Info</h4>
                        <ul class="space-y-5 text-stone-300 text-sm sm:text-base">
                            <li class="flex gap-4"><i class="fas fa-map-marker-alt mt-1 text-amber-400"></i><span>123 Brick Lane, London E1 6QR, UK</span></li>
                            <li class="flex gap-4"><i class="fas fa-phone text-amber-400"></i><span>+44 (0)20 1234 5678</span></li>
                            <li class="flex gap-4"><i class="fas fa-envelope text-amber-400"></i><span>info@saffronspice.co.uk</span></li>
                            <li class="flex gap-4"><i class="fas fa-clock text-amber-400"></i><span>Mon‚ÄìSun: 11:30 ‚Äì 23:00</span></li>
                        </ul>
                    </div>
                </div>
                
                <div class="border-t border-white/10 mt-12 pt-8 flex flex-col md:flex-row justify-between items-center gap-5 text-stone-500 text-xs sm:text-sm">
                    <p>¬© 2025 Saffron & Spice. All rights reserved. Prices in GBP (¬£)</p>
                    <div class="flex gap-7">
                        <a href="#" class="hover:text-white transition">Privacy</a>
                        <a href="#" class="hover:text-white transition">Terms</a>
                        <a href="#" class="hover:text-white transition">FAQs</a>
                    </div>
                </div>
            </div>
        </footer>
    </div> <!-- End main relative -->

    <!-- ===== CART DRAWER ‚Äì MODERN GLASS ===== -->
    <div id="cart-drawer" class="fixed inset-0 z-[100] hidden">
        <div onclick="toggleCart()" class="absolute inset-0 bg-black/60 backdrop-blur-md"></div>
        <div class="absolute right-0 top-0 h-full w-full sm:max-w-md bg-white/95 backdrop-blur-2xl shadow-2xl flex flex-col cart-drawer border-l border-amber-200">
            <!-- Cart Header -->
            <div class="p-6 sm:p-8 bg-gradient-to-r from-red-900 to-orange-800 text-white">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-2xl sm:text-3xl font-black brand-font">Your Basket</h3>
                        <p class="text-amber-200 text-xs sm:text-sm mt-1">Review items before checkout</p>
                    </div>
                    <button onclick="toggleCart()" class="text-2xl hover:text-amber-300 p-2 hover:bg-white/10 rounded-full transition">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <!-- Cart Items -->
            <div id="cart-items-list" class="flex-1 overflow-y-auto p-6 space-y-4">
                <!-- Empty state -->
                <div class="flex flex-col items-center justify-center py-16 text-stone-400">
                    <div class="bg-stone-100 w-24 h-24 rounded-full flex items-center justify-center mb-5">
                        <i class="fas fa-shopping-basket text-stone-400 text-3xl"></i>
                    </div>
                    <p class="text-stone-500 font-medium mb-1">Your basket is empty</p>
                    <p class="text-stone-400 text-sm">Add delicious items from our menu!</p>
                </div>
            </div>
            
            <!-- Cart Footer -->
            <div class="p-6 border-t border-stone-200 bg-stone-50/80 space-y-5">
                <div class="flex justify-between items-center">
                    <span class="text-stone-600 font-medium text-sm sm:text-base">Total Amount</span>
                    <span id="display-total" class="text-2xl sm:text-3xl font-black bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent">¬£0.00</span>
                </div>
                
                <div class="flex gap-3">
                    <button onclick="clearCart()" class="flex-1 bg-stone-200 hover:bg-stone-300 py-3.5 rounded-xl font-bold text-stone-700 transition text-sm sm:text-base">
                        Clear
                    </button>
                    <button onclick="openCheckout()" id="checkout-btn" disabled class="flex-1 bg-gradient-to-r from-orange-500 to-red-600 disabled:from-stone-400 disabled:to-stone-500 text-white py-3.5 rounded-xl font-bold shadow-lg hover:shadow-xl transition disabled:cursor-not-allowed">
                        Checkout
                    </button>
                </div>
                
                <p class="text-center text-stone-400 text-xs">
                    <i class="fas fa-lock mr-1"></i> Secure checkout ‚Ä¢ Free delivery over ¬£25
                </p>
            </div>
        </div>
    </div>

    <!-- ===== FLOATING CART BUTTON (Mobile) ===== -->
    <button onclick="toggleCart()" class="floating-cart-btn md:hidden shadow-2xl">
        <i class="fas fa-shopping-basket text-white text-2xl"></i>
        <span id="floating-cart-badge" class="absolute -top-1 -right-1 bg-red-800 text-white text-xs font-bold w-6 h-6 rounded-full flex items-center justify-center border-2 border-white shadow-lg hidden">0</span>
    </button>

    <!-- ===== PREMIUM CHECKOUT MODAL ‚Äì MODERN, STYLISH ===== -->
    <div id="checkout-modal" class="fixed inset-0 z-[110] hidden flex items-center justify-center p-4 overflow-y-auto">
        <div onclick="closeCheckout()" class="absolute inset-0 bg-black/70 backdrop-blur-xl"></div>
        
        <div class="relative bg-white w-full max-w-3xl rounded-3xl shadow-2xl max-h-[90vh] overflow-y-auto checkout-card animate-fade-up">
            <!-- Header with decorative pattern -->
            <div class="bg-gradient-to-r from-red-900 via-orange-800 to-amber-800 p-8 sm:p-10 text-white text-center relative overflow-hidden">
                <div class="absolute inset-0 bg-[url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><path d="M50 5 L95 50 L50 95 L5 50 Z" fill="white"/></svg>')] bg-repeat opacity-10"></div>
                <div class="relative z-10">
                    <div class="w-20 h-20 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4 border-2 border-white/30">
                        <i class="fas fa-receipt text-amber-300 text-3xl"></i>
                    </div>
                    <h3 class="text-3xl sm:text-4xl font-black brand-font mb-2 text-amber-300">Complete Your Order</h3>
                    <p class="text-amber-100 text-sm sm:text-base">You're one step away from an authentic Indian feast!</p>
                </div>
            </div>
            
            <!-- Form -->
            <form id="checkout-form" class="p-6 sm:p-10 space-y-7">
                <!-- Customer Info -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-bold text-stone-700 mb-2 flex items-center gap-2">
                            <i class="fas fa-user text-orange-500"></i> Full Name *
                        </label>
                        <input type="text" name="customerName" id="customerName" required 
                               placeholder="Enter your full name"
                               class="w-full bg-stone-50 border-2 border-stone-200 rounded-xl px-4 py-3.5 outline-none focus:border-orange-500 focus:bg-white transition-all focus:shadow-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-stone-700 mb-2 flex items-center gap-2">
                            <i class="fas fa-mobile-alt text-orange-500"></i> Mobile Number *
                        </label>
                        <input type="tel" name="customerPhone" id="customerPhone" required 
                               placeholder="UK mobile number"
                               class="w-full bg-stone-50 border-2 border-stone-200 rounded-xl px-4 py-3.5 outline-none focus:border-orange-500 focus:bg-white transition-all focus:shadow-lg">
                    </div>
                </div>
                
                <!-- Order Type ‚Äì Modern Card Options -->
                <div>
                    <label class="block text-sm font-bold text-stone-700 mb-4 flex items-center gap-2">
                        <i class="fas fa-truck text-orange-500"></i> How would you like to receive your order? *
                    </label>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <label class="payment-option p-5 rounded-xl border-2 border-stone-200 cursor-pointer hover:border-orange-400 transition-all bg-white">
                            <input type="radio" name="orderType" value="Delivery" checked class="hidden peer">
                            <div class="flex flex-col items-center text-center">
                                <div class="w-14 h-14 bg-gradient-to-br from-orange-100 to-red-100 rounded-full flex items-center justify-center mb-3 peer-checked:from-orange-500 peer-checked:to-red-600 transition-all">
                                    <i class="fas fa-truck text-orange-600 text-xl peer-checked:text-white"></i>
                                </div>
                                <span class="font-bold text-stone-800">Home Delivery</span>
                                <span class="text-xs text-stone-500 mt-1">Delivered to your door</span>
                            </div>
                        </label>
                        <label class="payment-option p-5 rounded-xl border-2 border-stone-200 cursor-pointer hover:border-orange-400 transition-all bg-white">
                            <input type="radio" name="orderType" value="Takeaway" class="hidden peer">
                            <div class="flex flex-col items-center text-center">
                                <div class="w-14 h-14 bg-gradient-to-br from-orange-100 to-red-100 rounded-full flex items-center justify-center mb-3 peer-checked:from-orange-500 peer-checked:to-red-600 transition-all">
                                    <i class="fas fa-shopping-bag text-orange-600 text-xl peer-checked:text-white"></i>
                                </div>
                                <span class="font-bold text-stone-800">Takeaway</span>
                                <span class="text-xs text-stone-500 mt-1">Pick up from restaurant</span>
                            </div>
                        </label>
                        <label class="payment-option p-5 rounded-xl border-2 border-stone-200 cursor-pointer hover:border-orange-400 transition-all bg-white">
                            <input type="radio" name="orderType" value="Dine-in" class="hidden peer">
                            <div class="flex flex-col items-center text-center">
                                <div class="w-14 h-14 bg-gradient-to-br from-orange-100 to-red-100 rounded-full flex items-center justify-center mb-3 peer-checked:from-orange-500 peer-checked:to-red-600 transition-all">
                                    <i class="fas fa-utensils text-orange-600 text-xl peer-checked:text-white"></i>
                                </div>
                                <span class="font-bold text-stone-800">Dine-in</span>
                                <span class="text-xs text-stone-500 mt-1">Eat at our restaurant</span>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Dynamic Sections Container -->
                <div id="dynamic-sections" class="space-y-6">
                    <!-- Default Delivery Section (will be shown by JS) -->
                </div>
                
                <!-- Order Summary ‚Äì Premium Card -->
                <div class="bg-gradient-to-br from-stone-50 to-white p-6 sm:p-7 rounded-2xl border-2 border-orange-100">
                    <h4 class="font-bold text-stone-800 mb-5 flex items-center gap-2 text-lg">
                        <i class="fas fa-shopping-basket text-orange-500"></i> Order Summary
                    </h4>
                    <div id="checkout-order-summary" class="space-y-3 mb-5 max-h-40 overflow-y-auto pr-2">
                        <!-- JS will populate -->
                    </div>
                    <div class="border-t border-stone-200 pt-5 flex justify-between items-center">
                        <span class="font-bold text-stone-700 text-lg">Total Amount</span>
                        <span id="checkout-total" class="text-3xl font-black bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent">¬£0.00</span>
                    </div>
                </div>
                
                <!-- Submit Button -->
                <button type="submit" id="final-order-btn" 
                        class="w-full bg-gradient-to-r from-orange-500 via-red-600 to-amber-700 text-white py-5 rounded-2xl font-bold shadow-2xl hover:shadow-3xl transition-all transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center text-lg gap-3 group">
                    <i class="fas fa-check-circle group-hover:scale-110 transition"></i> 
                    Confirm & Place Order
                </button>
                
                <p class="text-center text-stone-400 text-xs">
                    <i class="fas fa-shield-alt mr-1"></i> Your information is secure and encrypted
                </p>
            </form>
        </div>
    </div>

    <!-- ===== CELEBRATION SUCCESS SCREEN ‚Äì LUXURY DESIGN ===== -->
    <div id="success-screen" class="fixed inset-0 z-[200] hidden flex-col items-center justify-center p-6 text-center bg-gradient-to-br from-emerald-50 via-white to-amber-50 overflow-y-auto">
        <!-- Confetti animation -->
        <div id="confetti-container" class="absolute inset-0 pointer-events-none overflow-hidden">
            <div class="confetti" style="left: 10%; animation-delay: 0s;"></div>
            <div class="confetti" style="left: 20%; background: #f59e0b; animation-delay: 0.3s;"></div>
            <div class="confetti" style="left: 35%; background: #10b981; animation-delay: 0.7s;"></div>
            <div class="confetti" style="left: 50%; background: #3b82f6; animation-delay: 0.2s;"></div>
            <div class="confetti" style="left: 65%; background: #8b5cf6; animation-delay: 0.9s;"></div>
            <div class="confetti" style="left: 80%; background: #ec4899; animation-delay: 0.5s;"></div>
            <div class="confetti" style="left: 95%; background: #f97316; animation-delay: 1.1s;"></div>
        </div>
        
        <div class="relative z-30 max-w-2xl mx-auto glass-deep p-10 sm:p-16 rounded-4xl">
            <!-- Success Checkmark -->
            <div class="success-checkmark mb-8">
                <div class="check-icon">
                    <span class="icon-line line-tip"></span>
                    <span class="icon-line line-long"></span>
                </div>
            </div>
            
            <!-- Success Message -->
            <h3 class="text-4xl sm:text-5xl md:text-6xl font-black brand-font bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent mb-4">
                Order Confirmed!
            </h3>
            <p class="text-stone-600 text-lg sm:text-xl mb-3">Thank you for choosing Saffron & Spice</p>
            
            <!-- Order ID Card -->
            <div class="bg-white/80 backdrop-blur rounded-2xl p-6 mb-6 border border-emerald-200 shadow-xl">
                <p class="text-sm text-stone-500 mb-1">Your Order ID</p>
                <p id="success-order-id" class="font-mono text-2xl sm:text-3xl font-bold text-emerald-700 tracking-wider"></p>
            </div>
            
            <!-- Payment Instructions Container -->
            <div id="payment-instructions" class="mb-8 animate-fade-up"></div>
            
            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="location.reload()" class="bg-gradient-to-r from-stone-800 to-stone-900 text-white px-8 py-4 rounded-full font-bold hover:from-stone-900 hover:to-black transition-all transform hover:-translate-y-1 flex items-center justify-center gap-3 shadow-xl">
                    <i class="fas fa-shopping-bag"></i>
                    Order Again
                </button>
                <button onclick="openTrackingWithId()" class="bg-gradient-to-r from-orange-500 to-red-600 text-white px-8 py-4 rounded-full font-bold hover:from-orange-600 hover:to-red-700 transition-all transform hover:-translate-y-1 flex items-center justify-center gap-3 shadow-xl">
                    <i class="fas fa-truck"></i>
                    Track Order
                </button>
                <button onclick="closeSuccess()" class="bg-white text-stone-700 px-8 py-4 rounded-full font-bold hover:bg-stone-50 transition-all transform hover:-translate-y-1 border-2 border-stone-200 shadow-xl flex items-center justify-center gap-3">
                    <i class="fas fa-times"></i>
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- ===== TRACKING MODAL ‚Äì MODERN ===== -->
    <div id="tracking-modal" class="fixed inset-0 z-[150] hidden flex items-center justify-center p-4">
        <div onclick="closeTracking()" class="absolute inset-0 bg-black/70 backdrop-blur-md"></div>
        <div class="relative bg-white w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-red-900 to-orange-800 p-8 text-white text-center">
                <div class="w-20 h-20 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4 border-2 border-white/30">
                    <i class="fas fa-truck text-2xl"></i>
                </div>
                <h3 class="text-2xl sm:text-3xl font-bold brand-font mb-2 text-amber-300">Track Your Order</h3>
                <p class="text-amber-100 text-sm">Enter your order ID to check real-time status</p>
            </div>
            <div class="p-8 space-y-6">
                <div>
                    <label class="block text-sm font-bold text-stone-700 mb-2">Order ID</label>
                    <div class="relative">
                        <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-stone-400"></i>
                        <input type="text" id="track-order-id" placeholder="e.g., ORD-123456" 
                               class="w-full bg-stone-50 border-2 border-stone-200 rounded-xl pl-12 pr-4 py-4 outline-none focus:border-orange-500 transition-all">
                    </div>
                </div>
                <button onclick="trackOrder()" class="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white py-4 rounded-xl font-bold shadow-xl hover:shadow-2xl transition-all transform hover:scale-[1.02] flex items-center justify-center gap-3">
                    <i class="fas fa-search"></i>
                    Track Order
                </button>
                
                <div id="tracking-result" class="mt-6 hidden animate-fade-up">
                    <div class="bg-gradient-to-br from-stone-50 to-white p-6 rounded-xl border-2 border-orange-100">
                        <!-- Tracking result will be populated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== JAVASCRIPT ‚Äì FULLY FUNCTIONAL WITH GOOGLE SHEETS INTEGRATION ===== -->
    <script>
        // ---------- CONFIGURATION ----------
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzCO8-yMvRXq3JvGlYKKan3fAWjm2zkG4q7pVuW45NuHifQkMvdfUnl06TKBWXj_M_N/exec";
        
        // ---------- GLOBAL STATE ----------
        let allProducts = [];
        let userCart = [];
        let lastOrderId = null;
        let currentFilter = 'all';
        let searchTimeout = null;

        // ---------- INITIALIZATION ----------
        window.addEventListener('DOMContentLoaded', function() {
            loadMenuFromDatabase();
            setupEventListeners();
            
            // Load cart from localStorage
            const savedCart = localStorage.getItem('saffronSpiceCart');
            if (savedCart) {
                try {
                    userCart = JSON.parse(savedCart);
                    syncCart();
                } catch (e) {
                    console.error('Error parsing cart:', e);
                    localStorage.removeItem('saffronSpiceCart');
                }
            }
        });

        // ---------- EVENT LISTENERS ----------
        function setupEventListeners() {
            // Order type change
            const orderTypeRadios = document.querySelectorAll('input[name="orderType"]');
            orderTypeRadios.forEach(radio => {
                radio.addEventListener('change', handleOrderTypeChange);
            });
            
            // Payment method change
            const paymentRadios = document.querySelectorAll('input[name="paymentMethod"]');
            paymentRadios.forEach(radio => {
                radio.addEventListener('change', handlePaymentMethodChange);
            });
            
            // Checkout form submission
            const checkoutForm = document.getElementById('checkout-form');
            if (checkoutForm) {
                checkoutForm.addEventListener('submit', handleOrderSubmission);
            }
            
            // Set default to Delivery on load
            setTimeout(() => {
                const deliveryRadio = document.querySelector('input[name="orderType"][value="Delivery"]');
                if (deliveryRadio) {
                    deliveryRadio.checked = true;
                    handleOrderTypeChange.call({ target: { value: 'Delivery' } });
                }
            }, 100);
        }

        // ---------- LOAD MENU FROM GOOGLE SHEETS ----------
        async function loadMenuFromDatabase() {
            try {
                console.log('Loading menu from Google Sheets...');
                
                const response = await fetch(`${SCRIPT_URL}?action=getProducts&t=${Date.now()}`);
                
                if (!response.ok) {
                    throw new Error(`Network response failed: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Received products:', data);
                
                if (data && Array.isArray(data) && data.length > 0) {
                    allProducts = data;
                    
                    // Cache the products
                    localStorage.setItem('saffronSpiceMenu', JSON.stringify(allProducts));
                    
                    generateCategoryFilters();
                    filterItems('all', '');
                    showToast(`‚úì Loaded ${allProducts.length} menu items`, 'success');
                    
                } else {
                    // No products in database - use demo data
                    console.warn('No products received, using demo data');
                    allProducts = [
                        { name: "Butter Chicken", price: 14.99, category: "Curry", description: "Creamy tomato gravy with tender chicken", image: "https://images.unsplash.com/photo-1603894584373-5ac82b2ae398?w=500" },
                        { name: "Lamb Biryani", price: 16.50, category: "Biryani", description: "Fragrant basmati rice with spiced lamb", image: "https://images.unsplash.com/photo-1589302168068-964664d93dc0?w=500" },
                        { name: "Garlic Naan", price: 3.50, category: "Rice/Bread", description: "Butter garlic naan, freshly baked", image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?w=500" },
                        { name: "Samosa", price: 4.99, category: "Starter", description: "Crispy pastry with spiced potato & peas", image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?w=500" },
                        { name: "Tandoori Chicken", price: 13.99, category: "Tandoori", description: "Grilled yogurt-marinated chicken", image: "https://images.unsplash.com/photo-1626777552726-4a6b54c97e46?w=500" },
                        { name: "Chicken Tikka", price: 12.50, category: "Grill", description: "Spicy chargrilled chicken pieces", image: "https://images.unsplash.com/photo-1599487488170-d11ec9c172f0?w=500" },
                        { name: "Vegetable Korma", price: 11.99, category: "Vegetarian", description: "Mixed vegetables in creamy cashew sauce", image: "https://images.unsplash.com/photo-1585937421612-70a008356fbe?w=500" },
                        { name: "Chana Masala", price: 9.99, category: "Vegetarian", description: "Chickpea curry with aromatic spices", image: "https://images.unsplash.com/photo-1626777552726-4a6b54c97e46?w=500" }
                    ];
                    generateCategoryFilters();
                    filterItems('all', '');
                    document.getElementById('no-products')?.classList.add('hidden');
                }
                
            } catch (err) {
                console.error('Error loading menu:', err);
                // Fallback to demo data
                allProducts = [
                    { name: "Butter Chicken", price: 14.99, category: "Curry", description: "Creamy tomato gravy", image: "https://images.unsplash.com/photo-1603894584373-5ac82b2ae398?w=500" },
                    { name: "Lamb Biryani", price: 16.50, category: "Biryani", description: "Fragrant basmati", image: "https://images.unsplash.com/photo-1589302168068-964664d93dc0?w=500" },
                    { name: "Garlic Naan", price: 3.50, category: "Rice/Bread", description: "Butter garlic", image: "https://images.unsplash.com/photo-1601050690597-df0568f70950?w=500" }
                ];
                generateCategoryFilters();
                filterItems('all', '');
                showToast('Using demo menu', 'info');
            }
        }

        // ---------- GENERATE CATEGORY FILTERS ----------
        function generateCategoryFilters() {
            const defaultCategories = [
                'Starter', 'Curry', 'Biryani', 'Rice/Bread', 'Tandoori', 
                'Grill', 'Vegetarian', 'Seafood', 'Street Food'
            ];
            
            let categoriesSet = new Set(['all']);
            
            if (allProducts && allProducts.length > 0) {
                allProducts.forEach(p => { if (p.category) categoriesSet.add(p.category); });
            }
            
            defaultCategories.forEach(cat => categoriesSet.add(cat));
            
            const categories = Array.from(categoriesSet);
            const container = document.getElementById('category-filters-container');
            if (!container) return;
            
            container.innerHTML = categories.map(category => {
                const displayName = category === 'all' ? 'All Dishes' : category;
                const isActive = category === 'all';
                
                return `
                    <button onclick="filterItems('${category}')" 
                        class="category-filter ${isActive ? 'active' : ''} px-4 md:px-6 py-2.5 md:py-3 rounded-full font-bold text-sm transition-all shadow-sm">
                        ${displayName}
                    </button>
                `;
            }).join('');
        }

        // ---------- FILTER ITEMS ----------
        function filterItems(category, searchTerm = '') {
            currentFilter = category;
            
            const grid = document.getElementById('product-grid');
            const noResults = document.getElementById('no-results');
            const noProducts = document.getElementById('no-products');
            
            if (!grid) return;
            
            if (!allProducts || allProducts.length === 0) {
                grid.innerHTML = '';
                if (noProducts) noProducts.classList.remove('hidden');
                if (noResults) noResults.classList.add('hidden');
                return;
            }
            
            let filteredData = category === 'all' ? allProducts : allProducts.filter(p => p.category === category);
            
            // Apply search filter
            if (searchTerm && searchTerm.trim() !== '') {
                const searchLower = searchTerm.toLowerCase().trim();
                filteredData = filteredData.filter(p => 
                    (p.name && p.name.toLowerCase().includes(searchLower)) || 
                    (p.description && p.description.toLowerCase().includes(searchLower)) ||
                    (p.category && p.category.toLowerCase().includes(searchLower))
                );
            }
            
            // Show/hide no results
            if (filteredData.length === 0) {
                grid.innerHTML = '';
                if (noResults) noResults.classList.remove('hidden');
                if (noProducts) noProducts.classList.add('hidden');
            } else {
                if (noResults) noResults.classList.add('hidden');
                if (noProducts) noProducts.classList.add('hidden');
                renderProductGrid(filteredData, searchTerm);
            }
            
            // Update active filter button
            document.querySelectorAll('.category-filter').forEach(btn => {
                btn.classList.remove('active');
                const btnText = btn.innerText.toLowerCase();
                const filterLower = category.toLowerCase();
                
                if ((btnText.includes('all dishes') && category === 'all') || 
                    (btnText.includes(filterLower) && filterLower !== 'all')) {
                    btn.classList.add('active');
                }
            });
        }

        // ---------- RENDER PRODUCT GRID ----------
        function renderProductGrid(products, searchTerm = '') {
            const grid = document.getElementById('product-grid');
            if (!grid) return;
            
            grid.innerHTML = products.map(p => {
                const existingItem = userCart.find(item => item.name === p.name);
                const quantity = existingItem ? existingItem.quantity : 0;
                
                let imageUrl = p.image || 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=500';
                
                return `
                    <div class="menu-card rounded-3xl overflow-hidden shadow-lg hover:shadow-2xl">
                        <div class="h-56 overflow-hidden relative">
                            <div class="menu-image w-full h-full" style="background-image: url('${imageUrl}')"></div>
                            <div class="absolute top-4 right-4 bg-gradient-to-r from-orange-600 to-red-600 text-white px-4 py-2 rounded-full text-sm font-bold shadow-xl">
                                ¬£${parseFloat(p.price).toFixed(2)}
                            </div>
                            <span class="absolute bottom-4 left-4 bg-white/90 backdrop-blur px-4 py-2 rounded-full text-xs font-bold text-orange-700 border border-orange-200 shadow-lg">
                                ${p.category || 'Dish'}
                            </span>
                        </div>
                        <div class="p-6 flex-1 flex flex-col">
                            <h4 class="text-lg sm:text-xl font-bold product-name-font mb-3 text-stone-800">${p.name}</h4>
                            <p class="text-stone-500 text-xs sm:text-sm mb-5 line-clamp-2 flex-1">${p.description || 'Authentic Indian recipe'}</p>
                            
                            ${quantity > 0 ? `
                                <div class="flex items-center justify-between bg-gradient-to-r from-orange-50 to-red-50 p-2 rounded-xl">
                                    <button onclick="updateQuantity('${p.name.replace(/'/g, "\\'")}', -1)" 
                                            class="w-10 h-10 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:shadow-lg transition-all">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span class="font-bold text-lg text-stone-800">${quantity}</span>
                                    <button onclick="updateQuantity('${p.name.replace(/'/g, "\\'")}', 1)" 
                                            class="w-10 h-10 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:shadow-lg transition-all">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            ` : `
                                <button onclick="addItemToCart('${p.name.replace(/'/g, "\\'")}', ${p.price})" 
                                        class="w-full py-4 bg-gradient-to-r from-stone-800 to-stone-900 hover:from-orange-500 hover:to-red-600 text-white rounded-xl font-bold text-sm sm:text-base transition-all shadow-md hover:shadow-xl flex items-center justify-center gap-2">
                                    <i class="fas fa-plus"></i> Add to Cart
                                </button>
                            `}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ---------- CART FUNCTIONS ----------
        function addItemToCart(name, price) {
            const existingItem = userCart.find(item => item.name === name);
            
            if (existingItem) {
                existingItem.quantity += 1;
                existingItem.totalPrice = existingItem.quantity * parseFloat(price);
            } else {
                userCart.push({ 
                    name, 
                    price: parseFloat(price), 
                    id: Date.now() + Math.random(),
                    quantity: 1,
                    totalPrice: parseFloat(price)
                });
            }
            
            syncCart();
            showToast('‚úì Added to basket!', 'success');
            
            const searchInput = document.getElementById('search-box')?.value || '';
            filterItems(currentFilter, searchInput);
        }

        function updateQuantity(name, change) {
            const item = userCart.find(item => item.name === name);
            if (!item) return;
            
            item.quantity += change;
            
            if (item.quantity <= 0) {
                userCart = userCart.filter(i => i.name !== name);
                showToast('‚úó Removed from basket', 'info');
            } else {
                item.totalPrice = item.quantity * parseFloat(item.price);
            }
            
            syncCart();
            
            const searchInput = document.getElementById('search-box')?.value || '';
            filterItems(currentFilter, searchInput);
        }

        function removeItem(id) {
            const item = userCart.find(i => i.id === id);
            if (item) {
                showToast(`‚úó ${item.name} removed`, 'info');
            }
            userCart = userCart.filter(i => i.id !== id);
            syncCart();
            
            const searchInput = document.getElementById('search-box')?.value || '';
            filterItems(currentFilter, searchInput);
        }

        function clearCart() {
            if (userCart.length === 0) {
                showToast('Basket is already empty', 'info');
                return;
            }
            
            userCart = [];
            syncCart();
            showToast('‚úì Basket cleared', 'info');
            
            const searchInput = document.getElementById('search-box')?.value || '';
            filterItems(currentFilter, searchInput);
        }

        function syncCart() {
            const list = document.getElementById('cart-items-list');
            const totalEl = document.getElementById('display-total');
            const badge = document.getElementById('cart-badge');
            const floatingBadge = document.getElementById('floating-cart-badge');
            const btn = document.getElementById('checkout-btn');
            const checkoutSummary = document.getElementById('checkout-order-summary');
            const checkoutTotal = document.getElementById('checkout-total');
            
            const totalItems = userCart.reduce((sum, item) => sum + (item.quantity || 0), 0);
            const totalPrice = userCart.reduce((sum, item) => sum + parseFloat(item.totalPrice || 0), 0);
            
            // Update badges
            if (badge) {
                badge.innerText = totalItems;
                badge.classList.toggle('hidden', totalItems === 0);
            }
            
            if (floatingBadge) {
                floatingBadge.innerText = totalItems;
                floatingBadge.classList.toggle('hidden', totalItems === 0);
            }
            
            if (btn) btn.disabled = totalItems === 0;
            
            // Update total display
            if (totalEl) totalEl.innerText = `¬£${totalPrice.toFixed(2)}`;
            if (checkoutTotal) checkoutTotal.innerText = `¬£${totalPrice.toFixed(2)}`;
            
            // Render cart items
            if (list) {
                if (totalItems === 0) {
                    list.innerHTML = `
                        <div class="flex flex-col items-center justify-center py-16 text-stone-400">
                            <div class="bg-stone-100 w-24 h-24 rounded-full flex items-center justify-center mb-5">
                                <i class="fas fa-shopping-basket text-stone-400 text-3xl"></i>
                            </div>
                            <p class="text-stone-500 font-medium mb-1">Your basket is empty</p>
                            <p class="text-stone-400 text-sm mb-6">Add delicious items from our menu!</p>
                            <button onclick="toggleCart()" class="bg-gradient-to-r from-orange-500 to-red-600 text-white px-6 py-3 rounded-full font-medium shadow-lg">
                                Browse Menu
                            </button>
                        </div>
                    `;
                } else {
                    list.innerHTML = userCart.map(i => `
                        <div class="flex items-center gap-4 p-4 bg-gradient-to-br from-stone-50 to-white rounded-xl border-2 border-stone-100 hover:shadow-md transition-all">
                            <div class="flex-1">
                                <p class="font-bold text-stone-800 text-base">${i.name}</p>
                                <p class="text-orange-600 font-bold text-sm">¬£${parseFloat(i.price).toFixed(2)} each</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="flex items-center bg-gradient-to-r from-orange-100 to-red-100 rounded-xl p-1">
                                    <button onclick="updateQuantity('${i.name.replace(/'/g, "\\'")}', -1)" 
                                            class="w-8 h-8 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:shadow-md transition-all">
                                        <i class="fas fa-minus text-xs"></i>
                                    </button>
                                    <span class="mx-3 font-bold text-stone-800">${i.quantity}</span>
                                    <button onclick="updateQuantity('${i.name.replace(/'/g, "\\'")}', 1)" 
                                            class="w-8 h-8 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:shadow-md transition-all">
                                        <i class="fas fa-plus text-xs"></i>
                                    </button>
                                </div>
                                <div class="text-right min-w-[80px]">
                                    <p class="font-bold text-stone-800">¬£${parseFloat(i.totalPrice).toFixed(2)}</p>
                                </div>
                                <button onclick="removeItem(${i.id})" class="text-stone-300 hover:text-red-600 transition-all p-2">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                    `).join('');
                }
            }
            
            // Update checkout summary
            if (checkoutSummary) {
                if (totalItems === 0) {
                    checkoutSummary.innerHTML = '<p class="text-stone-400 text-center py-4">No items in basket</p>';
                } else {
                    checkoutSummary.innerHTML = userCart.map(i => `
                        <div class="flex justify-between items-center py-2 border-b border-stone-100 last:border-0">
                            <span class="text-sm text-stone-600">${i.quantity}x ${i.name}</span>
                            <span class="text-sm font-bold text-stone-800">¬£${parseFloat(i.totalPrice).toFixed(2)}</span>
                        </div>
                    `).join('');
                }
            }
            
            // Save to localStorage
            localStorage.setItem('saffronSpiceCart', JSON.stringify(userCart));
        }

        // ---------- ORDER TYPE HANDLER ----------
        function handleOrderTypeChange(e) {
            const orderType = e?.target?.value || 'Delivery';
            const dynamicDiv = document.getElementById('dynamic-sections');
            if (!dynamicDiv) return;
            
            if (orderType === 'Delivery') {
                dynamicDiv.innerHTML = `
                    <!-- Delivery Section -->
                    <div id="delivery-section" class="space-y-6 animate-fade-up">
                        <div class="bg-gradient-to-r from-blue-50 to-cyan-50 p-6 rounded-xl border-2 border-blue-200">
                            <div class="flex items-center gap-3 mb-6">
                                <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-home text-white text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-blue-800">UK Delivery Address</h4>
                                    <p class="text-xs text-blue-600">We deliver to all UK postcodes</p>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-bold text-stone-700 mb-2">Full Address *</label>
                                    <input type="text" name="deliveryAddress" id="deliveryAddress" 
                                           placeholder="e.g., 123 Baker Street, London" 
                                           class="w-full bg-white border-2 border-stone-200 rounded-xl px-4 py-3.5 outline-none focus:border-blue-500 transition-all">
                                </div>
                                
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-bold text-stone-700 mb-2">City/Area *</label>
                                        <input type="text" name="deliveryArea" id="deliveryArea" 
                                               placeholder="e.g., Central London"
                                               class="w-full bg-white border-2 border-stone-200 rounded-xl px-4 py-3.5 outline-none focus:border-blue-500 transition-all">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-bold text-stone-700 mb-2">Postcode *</label>
                                        <input type="text" name="postcode" id="postcode" 
                                               placeholder="e.g., W1A 1AA" 
                                               class="w-full bg-white border-2 border-stone-200 rounded-xl px-4 py-3.5 outline-none focus:border-blue-500 transition-all">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Payment Method -->
                        <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-6 rounded-xl border-2 border-amber-200">
                            <div class="flex items-center gap-3 mb-6">
                                <div class="w-12 h-12 bg-amber-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-credit-card text-white text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-amber-800">Payment Method</h4>
                                    <p class="text-xs text-amber-600">Choose how you'd like to pay</p>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <label class="flex items-center gap-4 p-4 bg-white rounded-xl border-2 border-stone-200 cursor-pointer hover:border-amber-400 transition-all">
                                    <input type="radio" name="paymentMethod" value="cash" checked class="w-5 h-5 text-amber-500">
                                    <div class="flex-1">
                                        <span class="font-bold text-stone-800">Cash on Delivery</span>
                                        <span class="text-xs text-stone-500 block">Pay with cash when order arrives</span>
                                    </div>
                                    <div class="w-10 h-10 bg-gradient-to-br from-green-100 to-emerald-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-money-bill-wave text-green-600 text-lg"></i>
                                    </div>
                                </label>
                                
                                <label class="flex items-center gap-4 p-4 bg-white rounded-xl border-2 border-stone-200 cursor-pointer hover:border-amber-400 transition-all">
                                    <input type="radio" name="paymentMethod" value="card" class="w-5 h-5 text-amber-500">
                                    <div class="flex-1">
                                        <span class="font-bold text-stone-800">Card Payment</span>
                                        <span class="text-xs text-stone-500 block">Pay via bank transfer</span>
                                    </div>
                                    <div class="w-10 h-10 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-credit-card text-blue-600 text-lg"></i>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Card Payment Details -->
                        <div id="card-payment-section" class="hidden animate-fade-up">
                            <div class="bg-gradient-to-br from-indigo-600 to-purple-700 text-white p-6 rounded-xl shadow-xl">
                                <div class="flex items-center gap-3 mb-5">
                                    <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                                        <i class="fas fa-university text-amber-300"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-white">Bank Transfer Details</h4>
                                        <p class="text-xs text-amber-200">Use Order ID as payment reference</p>
                                    </div>
                                </div>
                                
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center border-b border-white/20 pb-3">
                                        <span class="font-medium text-white/80">Account Number</span>
                                        <div class="flex items-center gap-2">
                                            <span class="font-mono font-bold text-white">4921 ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 2412</span>
                                            <button type="button" onclick="copyToClipboard('49212412')" class="bg-white/20 px-3 py-1.5 rounded-lg text-xs font-medium hover:bg-white/30 transition-all">
                                                <i class="far fa-copy"></i> Copy
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="flex justify-between items-center border-b border-white/20 pb-3">
                                        <span class="font-medium text-white/80">Sort Code</span>
                                        <div class="flex items-center gap-2">
                                            <span class="font-mono font-bold text-white">60-83-71</span>
                                            <button type="button" onclick="copyToClipboard('608371')" class="bg-white/20 px-3 py-1.5 rounded-lg text-xs font-medium hover:bg-white/30 transition-all">
                                                <i class="far fa-copy"></i> Copy
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="flex justify-between items-center">
                                        <span class="font-medium text-white/80">Account Name</span>
                                        <span class="font-bold text-white">SAFFRON & SPICE LTD</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Re-attach payment method listeners
                document.querySelectorAll('input[name="paymentMethod"]').forEach(r => {
                    r.addEventListener('change', handlePaymentMethodChange);
                });
                
            } else if (orderType === 'Takeaway') {
                dynamicDiv.innerHTML = `
                    <div id="takeaway-section" class="space-y-6 animate-fade-up">
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border-2 border-green-200">
                            <div class="flex items-center gap-3 mb-6">
                                <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-clock text-white text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-green-800">Collection Time</h4>
                                    <p class="text-xs text-green-600">When would you like to pick up your order?</p>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-bold text-stone-700 mb-2">Select Date & Time *</label>
                                <input type="datetime-local" name="collectionTime" id="collectionTime" 
                                       class="w-full bg-white border-2 border-stone-200 rounded-xl px-4 py-3.5 outline-none focus:border-green-500 transition-all">
                                <p class="text-xs text-stone-500 mt-2">
                                    <i class="fas fa-info-circle mr-1"></i> Minimum 30 minutes preparation time
                                </p>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-blue-50 to-cyan-50 p-6 rounded-xl border-2 border-blue-200">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-cash-register text-white text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-blue-800">Pay at Counter</h4>
                                    <p class="text-sm text-blue-600">Simply pay when you arrive to collect</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Set default collection time to 30 minutes from now
                setTimeout(() => {
                    const collectionInput = document.getElementById('collectionTime');
                    if (collectionInput) {
                        const now = new Date();
                        now.setMinutes(now.getMinutes() + 30);
                        collectionInput.value = now.toISOString().slice(0, 16);
                    }
                }, 50);
                
            } else if (orderType === 'Dine-in') {
                dynamicDiv.innerHTML = `
                    <div id="dinein-section" class="space-y-6 animate-fade-up">
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-6 rounded-xl border-2 border-purple-200">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-chair text-white text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-purple-800">Table Number (Optional)</h4>
                                    <p class="text-xs text-purple-600">Let us know if you have a preference</p>
                                </div>
                            </div>
                            
                            <div>
                                <input type="text" name="tableNumber" id="tableNumber" 
                                       placeholder="e.g., Table 5, Window seat, Booth"
                                       class="w-full bg-white border-2 border-stone-200 rounded-xl px-4 py-3.5 outline-none focus:border-purple-500 transition-all">
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-red-50 to-rose-50 p-6 rounded-xl border-2 border-red-200">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center">
                                    <i class="fas fa-bell text-white text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-red-800">Pay at Your Table</h4>
                                    <p class="text-sm text-red-600">Our staff will bring the bill to you</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // ---------- PAYMENT METHOD HANDLER ----------
        function handlePaymentMethodChange(e) {
            const paymentMethod = e?.target?.value || 'cash';
            const cardSection = document.getElementById('card-payment-section');
            if (cardSection) {
                cardSection.classList.toggle('hidden', paymentMethod !== 'card');
            }
        }

        // ---------- ORDER SUBMISSION ‚Äì GOOGLE SHEETS INTEGRATION ----------
        async function handleOrderSubmission(e) {
            e.preventDefault();
            
            const formBtn = document.getElementById('final-order-btn');
            const formData = new FormData(e.target);
            
            // Validate cart
            if (userCart.length === 0) {
                showToast('Your basket is empty', 'info');
                return;
            }
            
            // Get order type
            const orderType = formData.get('orderType') || 'Delivery';
            
            // Validate required fields
            const customerName = formData.get('customerName');
            const customerPhone = formData.get('customerPhone');
            
            if (!customerName || !customerPhone) {
                showToast('Please fill in your name and phone number', 'info');
                return;
            }
            
            // Validate delivery fields
            if (orderType === 'Delivery') {
                const address = formData.get('deliveryAddress');
                const area = formData.get('deliveryArea');
                const postcode = formData.get('postcode');
                
                if (!address || !area || !postcode) {
                    showToast('Please fill in all delivery details', 'info');
                    return;
                }
            }
            
            // Validate collection time for takeaway
            if (orderType === 'Takeaway') {
                const collectionTime = formData.get('collectionTime');
                if (!collectionTime) {
                    showToast('Please select a collection time', 'info');
                    return;
                }
            }
            
            // Disable button and show loading
            formBtn.disabled = true;
            formBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Processing Order...';
            
            // Calculate total
            const total = userCart.reduce((sum, item) => sum + parseFloat(item.totalPrice || 0), 0);
            
            // Get payment method
            const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked')?.value || 'cash';
            
            // Prepare order data
            const orderId = "ORD-" + Date.now().toString().slice(-6) + "-" + Math.floor(Math.random() * 1000);
            const itemsList = userCart.map(item => `${item.quantity}x ${item.name}`).join(", ");
            
            // Collect delivery details
            let deliveryDetails = {};
            if (orderType === 'Delivery') {
                deliveryDetails = {
                    address: formData.get('deliveryAddress'),
                    area: formData.get('deliveryArea'),
                    postcode: formData.get('postcode')
                };
            }
            
            const orderData = {
                action: "submitOrder",
                orderId: orderId,
                customerName: customerName,
                customerPhone: customerPhone,
                orderType: orderType,
                tableNumber: formData.get('tableNumber') || '',
                totalAmount: '¬£' + total.toFixed(2),
                totalNumeric: total.toFixed(2),
                items: itemsList,
                itemsDetailed: JSON.stringify(userCart),
                deliveryDetails: JSON.stringify(deliveryDetails),
                paymentMethod: paymentMethod,
                collectionTime: formData.get('collectionTime') || '',
                status: 'pending',
                timestamp: new Date().toISOString(),
                lastUpdated: new Date().toLocaleString('en-GB', { 
                    day: '2-digit', 
                    month: '2-digit', 
                    year: 'numeric', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                })
            };

            try {
                // --- SUBMIT TO GOOGLE SHEETS ---
                console.log('Submitting order to Google Sheets:', orderData);
                
                let response;
                try {
                    response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        mode: 'cors',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: new URLSearchParams(orderData)
                    });
                } catch (fetchError) {
                    // Try alternative format
                    response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        mode: 'cors',
                        body: JSON.stringify(orderData)
                    });
                }
                
                const responseText = await response.text();
                console.log('Server response:', responseText);
                
                let responseData = null;
                try {
                    responseData = responseText ? JSON.parse(responseText) : null;
                } catch (_) {
                    responseData = null;
                }
                
                // Save order ID
                const savedOrderId = responseData?.orderId || responseData?.id || orderId;
                lastOrderId = savedOrderId;
                
                // --- SAVE TO LOCALSTORAGE AS BACKUP ---
                const savedOrders = JSON.parse(localStorage.getItem('saffronSpiceOrders') || '[]');
                savedOrders.push({ ...orderData, orderId: savedOrderId });
                localStorage.setItem('saffronSpiceOrders', JSON.stringify(savedOrders.slice(-20))); // Keep last 20 orders
                
                // --- SHOW SUCCESS SCREEN WITH PAYMENT INSTRUCTIONS ---
                const successOrderId = document.getElementById('success-order-id');
                if (successOrderId) successOrderId.textContent = savedOrderId;
                
                // Generate payment instructions based on order type
                const paymentInstructions = document.getElementById('payment-instructions');
                if (paymentInstructions) {
                    paymentInstructions.innerHTML = '';
                    
                    if (orderType === 'Delivery' && paymentMethod === 'card') {
                        paymentInstructions.innerHTML = `
                            <div class="bg-gradient-to-br from-indigo-50 to-purple-50 p-6 rounded-xl border-2 border-indigo-200 shadow-lg animate-fade-up">
                                <h4 class="font-bold text-indigo-700 mb-4 flex items-center gap-2 text-lg">
                                    <i class="fas fa-credit-card"></i> Payment Required
                                </h4>
                                <p class="text-sm text-stone-600 mb-4">Please transfer <span class="font-bold text-indigo-700 text-xl">¬£${total.toFixed(2)}</span> to:</p>
                                <div class="bg-white/80 backdrop-blur p-5 rounded-xl mb-3 border border-indigo-200">
                                    <div class="flex justify-between items-center mb-3">
                                        <span class="text-xs text-stone-500">Account Number:</span>
                                        <span class="font-mono font-bold text-indigo-700">4921 ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 2412</span>
                                    </div>
                                    <div class="flex justify-between items-center mb-3">
                                        <span class="text-xs text-stone-500">Sort Code:</span>
                                        <span class="font-mono font-bold text-indigo-700">60-83-71</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-stone-500">Reference:</span>
                                        <span class="font-mono font-bold bg-indigo-100 px-3 py-1.5 rounded-lg text-indigo-800">${savedOrderId}</span>
                                    </div>
                                </div>
                                <p class="text-xs text-stone-500 flex items-center gap-1">
                                    <i class="fas fa-info-circle text-indigo-500"></i> 
                                    Order will be processed once payment is confirmed (usually within 30 mins)
                                </p>
                            </div>
                        `;
                    } else if (orderType === 'Takeaway') {
                        const collectionTime = formData.get('collectionTime');
                        const formattedTime = collectionTime ? new Date(collectionTime).toLocaleString('en-GB', {
                            weekday: 'short',
                            day: 'numeric',
                            month: 'short',
                            hour: '2-digit',
                            minute: '2-digit'
                        }) : '30 minutes from now';
                        
                        paymentInstructions.innerHTML = `
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border-2 border-green-200 shadow-lg animate-fade-up">
                                <div class="flex items-center gap-4 mb-4">
                                    <div class="w-14 h-14 bg-green-500 rounded-full flex items-center justify-center">
                                        <i class="fas fa-clock text-white text-2xl"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-green-800 text-lg">Ready for Collection</h4>
                                        <p class="text-sm text-green-700">${formattedTime}</p>
                                    </div>
                                </div>
                                <p class="text-sm text-stone-600 bg-white/70 p-4 rounded-lg">
                                    <i class="fas fa-store-alt mr-2 text-green-600"></i>
                                    Please arrive on time and show your Order ID at the counter.
                                </p>
                            </div>
                        `;
                    } else if (orderType === 'Dine-in') {
                        const tableNumber = formData.get('tableNumber') || 'your table';
                        paymentInstructions.innerHTML = `
                            <div class="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-xl border-2 border-purple-200 shadow-lg animate-fade-up">
                                <div class="flex items-center gap-4">
                                    <div class="w-14 h-14 bg-purple-500 rounded-full flex items-center justify-center">
                                        <i class="fas fa-utensils text-white text-2xl"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-purple-800 text-lg">Dine-in Confirmed</h4>
                                        <p class="text-sm text-purple-700">We'll bring your order to ${tableNumber}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        // Cash on Delivery
                        paymentInstructions.innerHTML = `
                            <div class="bg-gradient-to-br from-amber-50 to-orange-50 p-6 rounded-xl border-2 border-amber-200 shadow-lg animate-fade-up">
                                <div class="flex items-center gap-4">
                                    <div class="w-14 h-14 bg-amber-500 rounded-full flex items-center justify-center">
                                        <i class="fas fa-money-bill-wave text-white text-2xl"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-amber-800 text-lg">Cash on Delivery</h4>
                                        <p class="text-sm text-amber-700">Pay ¬£${total.toFixed(2)} when your order arrives</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                }
                
                // Show success screen
                const successScreen = document.getElementById('success-screen');
                if (successScreen) successScreen.classList.remove('hidden');
                
                // Close modals
                closeCheckout();
                toggleCart();
                
                // Reset cart
                userCart = [];
                syncCart();
                localStorage.removeItem('saffronSpiceCart');
                
                // Update product grid
                const searchInput = document.getElementById('search-box')?.value || '';
                filterItems(currentFilter, searchInput);
                
                showToast('‚úì Order placed successfully!', 'success');
                
            } catch (err) {
                console.error('Order submission error:', err);
                
                // Still show success to user (graceful degradation)
                lastOrderId = orderId;
                
                // Show success screen with basic instructions
                const successOrderId = document.getElementById('success-order-id');
                if (successOrderId) successOrderId.textContent = orderId;
                
                const paymentInstructions = document.getElementById('payment-instructions');
                if (paymentInstructions) {
                    paymentInstructions.innerHTML = `
                        <div class="bg-gradient-to-br from-amber-50 to-orange-50 p-6 rounded-xl border-2 border-amber-200 shadow-lg">
                            <h4 class="font-bold text-amber-700 mb-3">Order Received</h4>
                            <p class="text-sm text-stone-600">Your order has been placed. We'll contact you shortly for confirmation.</p>
                            <p class="text-xs text-stone-500 mt-3">Order ID: <span class="font-mono font-bold">${orderId}</span></p>
                        </div>
                    `;
                }
                
                const successScreen = document.getElementById('success-screen');
                if (successScreen) successScreen.classList.remove('hidden');
                
                closeCheckout();
                toggleCart();
                userCart = [];
                syncCart();
                
                showToast('‚úì Order placed!', 'success');
                
            } finally {
                formBtn.disabled = false;
                formBtn.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Confirm & Place Order';
            }
        }

        // ---------- TOAST NOTIFICATION ----------
        function showToast(message, type = 'success') {
            // Remove existing toasts
            document.querySelectorAll('.toast-message').forEach(toast => toast.remove());
            
            const toast = document.createElement('div');
            toast.className = `toast-message flex items-center gap-3`;
            
            let bgColor = 'from-green-600 to-emerald-700';
            let icon = 'fa-check-circle';
            
            if (type === 'error') {
                bgColor = 'from-red-600 to-rose-700';
                icon = 'fa-exclamation-circle';
            } else if (type === 'info') {
                bgColor = 'from-blue-600 to-indigo-700';
                icon = 'fa-info-circle';
            }
            
            toast.className += ` bg-gradient-to-r ${bgColor}`;
            toast.innerHTML = `
                <i class="fas ${icon} text-white"></i>
                <span class="text-sm font-medium text-white">${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => toast.remove(), 300);
            }, 3500);
        }

        // ---------- TRACK ORDER ----------
        async function trackOrder() {
            const orderId = document.getElementById('track-order-id')?.value.trim();
            if (!orderId) {
                showToast('Please enter an order ID', 'info');
                return;
            }

            const resultDiv = document.getElementById('tracking-result');
            if (resultDiv) resultDiv.classList.add('hidden');
            
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getOrderStatus&orderId=${encodeURIComponent(orderId)}&t=${Date.now()}`);
                
                if (!response.ok) throw new Error('Network response failed');
                
                const data = await response.json();
                
                if (data && data.status) {
                    const statusColors = {
                        'pending': 'bg-yellow-500',
                        'preparing': 'bg-blue-500',
                        'ready': 'bg-green-500',
                        'dispatched': 'bg-purple-500',
                        'delivered': 'bg-emerald-500',
                        'cancelled': 'bg-red-500'
                    };
                    
                    const status = data.status.toLowerCase();
                    const color = statusColors[status] || 'bg-stone-500';
                    
                    resultDiv.innerHTML = `
                        <div class="bg-gradient-to-br from-stone-50 to-white p-6 rounded-xl border-2 border-orange-100">
                            <div class="flex items-center justify-between mb-6">
                                <h4 class="font-bold text-stone-800 flex items-center gap-2">
                                    <span class="w-2.5 h-2.5 ${color} rounded-full animate-pulse"></span>
                                    Order Status
                                </h4>
                                <span class="px-4 py-1.5 rounded-full text-xs font-bold text-white ${color}">
                                    ${data.status.toUpperCase()}
                                </span>
                            </div>
                            
                            <div class="space-y-4">
                                <div class="flex items-center gap-3 p-3 bg-white rounded-lg border border-stone-100">
                                    <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-info-circle text-orange-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <p class="text-xs text-stone-500">Order ID</p>
                                        <p class="font-bold text-stone-800">${data.id || orderId}</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center gap-3 p-3 bg-white rounded-lg border border-stone-100">
                                    <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-user text-orange-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <p class="text-xs text-stone-500">Customer</p>
                                        <p class="font-bold text-stone-800">${data.customerName || '‚Äî'}</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center gap-3 p-3 bg-white rounded-lg border border-stone-100">
                                    <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-credit-card text-orange-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <p class="text-xs text-stone-500">Payment</p>
                                        <p class="font-bold text-stone-800">${data.payment || 'Cash on Delivery'}</p>
                                    </div>
                                </div>
                                
                                ${data.table ? `
                                <div class="flex items-center gap-3 p-3 bg-white rounded-lg border border-stone-100">
                                    <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-chair text-orange-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <p class="text-xs text-stone-500">Table</p>
                                        <p class="font-bold text-stone-800">${data.table}</p>
                                    </div>
                                </div>
                                ` : ''}
                                
                                ${data.collectionTime ? `
                                <div class="flex items-center gap-3 p-3 bg-white rounded-lg border border-stone-100">
                                    <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-clock text-orange-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <p class="text-xs text-stone-500">Collection Time</p>
                                        <p class="font-bold text-stone-800">${new Date(data.collectionTime).toLocaleString()}</p>
                                    </div>
                                </div>
                                ` : ''}
                                
                                <div class="text-center text-xs text-stone-500 mt-4 pt-4 border-t border-stone-200">
                                    <i class="fas fa-history mr-1"></i>
                                    Last Updated: ${data.lastUpdated || new Date().toLocaleString()}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    resultDiv.classList.remove('hidden');
                } else {
                    showToast('Order not found', 'error');
                }
                
            } catch (err) {
                console.error('Tracking error:', err);
                
                // Check localStorage for backup orders
                const savedOrders = JSON.parse(localStorage.getItem('saffronSpiceOrders') || '[]');
                const order = savedOrders.find(o => o.orderId === orderId);
                
                if (order) {
                    resultDiv.innerHTML = `
                        <div class="bg-gradient-to-br from-stone-50 to-white p-6 rounded-xl border-2 border-orange-100">
                            <h4 class="font-bold text-stone-800 mb-4 flex items-center gap-2">
                                <span class="w-2.5 h-2.5 bg-yellow-500 rounded-full animate-pulse"></span>
                                Order Status (Offline)
                            </h4>
                            <p class="text-sm text-stone-600 mb-3">Order ID: <span class="font-mono font-bold">${order.orderId}</span></p>
                            <p class="text-sm text-stone-600 mb-2">Status: <span class="font-bold text-yellow-600">Pending</span></p>
                            <p class="text-xs text-stone-500">Your order has been saved locally. We'll process it shortly.</p>
                        </div>
                    `;
                    resultDiv.classList.remove('hidden');
                } else {
                    showToast('Order not found. Please check the ID.', 'error');
                }
            }
        }

        // ---------- UI UTILITIES ----------
        function toggleCart() {
            const drawer = document.getElementById('cart-drawer');
            if (!drawer) return;
            
            const cartContent = drawer.querySelector('.cart-drawer');
            
            if (drawer.classList.contains('hidden')) {
                drawer.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                setTimeout(() => {
                    if (cartContent) cartContent.classList.add('open');
                }, 10);
            } else {
                if (cartContent) cartContent.classList.remove('open');
                setTimeout(() => {
                    drawer.classList.add('hidden');
                    document.body.style.overflow = '';
                }, 400);
            }
        }

        function openCheckout() {
            if (userCart.length === 0) {
                showToast('Please add items to your basket first', 'info');
                return;
            }
            
            const modal = document.getElementById('checkout-modal');
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeCheckout() {
            const modal = document.getElementById('checkout-modal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = '';
            }
        }

        function openTracking() {
            const modal = document.getElementById('tracking-modal');
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeTracking() {
            const modal = document.getElementById('tracking-modal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = '';
            }
        }

        function openTrackingWithId() {
            if (lastOrderId) {
                const input = document.getElementById('track-order-id');
                if (input) {
                    input.value = lastOrderId;
                    setTimeout(() => trackOrder(), 100);
                }
            }
            closeSuccess();
            openTracking();
        }

        function closeSuccess() {
            const success = document.getElementById('success-screen');
            if (success) {
                success.classList.add('hidden');
                document.body.style.overflow = '';
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('‚úì Copied to clipboard!');
            }).catch(() => {
                showToast('Failed to copy', 'error');
            });
        }

        function handleSearch() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const searchTerm = document.getElementById('search-box')?.value || '';
                document.getElementById('clear-search')?.classList.toggle('hidden', !searchTerm);
                filterItems(currentFilter, searchTerm);
            }, 350);
        }

        function clearSearch() {
            const searchBox = document.getElementById('search-box');
            if (searchBox) searchBox.value = '';
            document.getElementById('clear-search')?.classList.add('hidden');
            filterItems(currentFilter, '');
        }

        // ---------- EXPOSE GLOBALLY ----------
        window.filterItems = filterItems;
        window.addItemToCart = addItemToCart;
        window.updateQuantity = updateQuantity;
        window.removeItem = removeItem;
        window.clearCart = clearCart;
        window.toggleCart = toggleCart;
        window.openCheckout = openCheckout;
        window.closeCheckout = closeCheckout;
        window.openTracking = openTracking;
        window.closeTracking = closeTracking;
        window.openTrackingWithId = openTrackingWithId;
        window.closeSuccess = closeSuccess;
        window.copyToClipboard = copyToClipboard;
        window.trackOrder = trackOrder;
        window.handleOrderSubmission = handleOrderSubmission;
        window.handleSearch = handleSearch;
        window.clearSearch = clearSearch;
        window.handleOrderTypeChange = handleOrderTypeChange;
        window.handlePaymentMethodChange = handlePaymentMethodChange;
    </script>
</body>
</html>
